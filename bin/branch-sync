#!/bin/bash

# how to use ğŸ‘‡
# ./bin/branch-sync post hexo

SCRIPT_NAME=$(basename "$0")

if [ -z "$1" ] || [ -z "$2" ]; then
  echo "è¯·æä¾›è¶³å¤Ÿçš„å‘½ä»¤è¡Œå‚æ•°"
  echo "ç”¨æ³•: $SCRIPT_NAME SOURCE_BRANCH TARGET_BRANCH"
  exit 1
fi

SOURCE_BRANCH="$1"
TARGET_BRANCH="$2"

# åˆ¤æ–­æ˜¯å¦å­˜åœ¨ SOURCE_BRANCH åˆ†æ”¯
if ! git show-ref --quiet refs/heads/$SOURCE_BRANCH; then
    echo "$SOURCE_BRANCH åˆ†æ”¯ä¸å­˜åœ¨ï¼Œæ­£åœ¨æ£€å‡º..."
    git checkout -b $SOURCE_BRANCH
    git branch -u origin/$SOURCE_BRANCH
fi

# åˆ¤æ–­æ˜¯å¦å­˜åœ¨ TARGET_BRANCH åˆ†æ”¯
if ! git show-ref --quiet refs/heads/$TARGET_BRANCH; then
    echo "$TARGET_BRANCH åˆ†æ”¯ä¸å­˜åœ¨ï¼Œæ­£åœ¨æ£€å‡º..."
    git checkout -b $TARGET_BRANCH
    git branch -u origin/$TARGET_BRANCH
fi

git fetch

git checkout $SOURCE_BRANCH
git branch -u origin/$SOURCE_BRANCH
git pull
git push

git checkout $TARGET_BRANCH
git branch -u origin/$TARGET_BRANCH
git pull
git merge origin/$SOURCE_BRANCH
git push

git checkout $SOURCE_BRANCH
